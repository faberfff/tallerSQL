-- MySQL Script generated by MySQL Workbench
-- Thu Mar 16 11:13:15 2023
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mytienda
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mytienda
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mytienda` DEFAULT CHARACTER SET utf8 ;
USE `mytienda` ;

-- -----------------------------------------------------
-- Table `mytienda`.`cliente_usuario`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mytienda`.`cliente_usuario` (
  `id` INT NOT NULL,
  `nombre` VARCHAR(45) NULL,
  -- UNIQUE INDEX `num_documento_UNIQUE` (`num_documento` ASC),
  PRIMARY KEY (`id`));


-- -----------------------------------------------------
-- Table `mytienda`.`producto`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mytienda`.`producto` (
  `id` INT NOT NULL auto_increment,
  `fecha_producto` DATE NOT NULL,
  `vence_producto` DATE NOT NULL,
  `stock` INT NOT NULL,
  PRIMARY KEY (`id`));


-- -----------------------------------------------------
-- Table `mytienda`.`proveedor`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mytienda`.`proveedor` (
  `id` INT NOT NULL auto_increment,
  `descuento_proveedor` VARCHAR(255) NULL,
  `nit_proveedor` VARCHAR(32) NOT NULL,
  `direccion_proveedor` VARCHAR(50) NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`));


-- -----------------------------------------------------
-- Table `mytienda`.`venta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mytienda`.`venta` (
  `id` INT NOT NULL auto_increment,
  `fecha_venta` DATE NULL,
  `cantidad` INT NOT NULL,
  `tipo_documento` VARCHAR(16) NOT NULL,
  `num_documento` VARCHAR(255) NOT NULL,
  `cliente_usuario_id` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_venta_cliente_usuario1_idx` (`cliente_usuario_id` ASC),
  CONSTRAINT `fk_venta_cliente_usuario1`
    FOREIGN KEY (`cliente_usuario_id`)
    REFERENCES `mytienda`.`cliente_usuario` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);


-- -----------------------------------------------------
-- Table `mytienda`.`producto_proveedor`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mytienda`.`producto_proveedor` (
  `producto_id` INT NOT NULL,
  `proveedor_id` INT NOT NULL,
  `nombre_producto` VARCHAR(255) NOT NULL,
  `nombre_proveedor` VARCHAR(255) NULL,
  `precio_compra` INT NOT NULL,
  `precio_venta` INT NOT NULL,
  PRIMARY KEY (`producto_id`, `proveedor_id`),
  INDEX `fk_producto_has_venta_producto1_idx` (`producto_id` ASC),
  INDEX `fk_producto_has_venta_proveedor1_idx` (`proveedor_id` ASC),
  CONSTRAINT `fk_producto_has_venta_producto1`
    FOREIGN KEY (`producto_id`)
    REFERENCES `mytienda`.`producto` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_producto_has_venta_proveedor1`
    FOREIGN KEY (`proveedor_id`)
    REFERENCES `mytienda`.`proveedor` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);


-- -----------------------------------------------------
-- Table `mytienda`.`detalle_venta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mytienda`.`detalle_venta` (
  `venta_id` INT NOT NULL,
  `producto_proveedor_producto_id` INT NOT NULL,
  `producto_proveedor_proveedor_id` INT NOT NULL,
  PRIMARY KEY (`venta_id`, `producto_proveedor_producto_id`, `producto_proveedor_proveedor_id`),
  INDEX `fk_venta_has_producto_venta1_idx` (`venta_id` ASC),
  INDEX `fk_detalle_venta_producto_proveedor1_idx` (`producto_proveedor_producto_id` ASC, `producto_proveedor_proveedor_id` ASC),
  CONSTRAINT `fk_venta_has_producto_venta1`
    FOREIGN KEY (`venta_id`)
    REFERENCES `mytienda`.`venta` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_detalle_venta_producto_proveedor1`
    FOREIGN KEY (`producto_proveedor_producto_id` , `producto_proveedor_proveedor_id`)
    REFERENCES `mytienda`.`producto_proveedor` (`producto_id` , `proveedor_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

    -- inserción datos tabla producto
    insert into producto(id, fecha_producto, vence_producto, stock)
    values
         (01, '2023-09-22', '2024-10-25',  50),
		 (02, '2023-04-18', '2024-07-30',  60),
		 (03, '2023-06-17', '2024-05-15',  105),
		 (04, '2023-01-11', '2024-02-27',  78),
		 (05, '2023-05-10', '2024-12-07',  88);


      -- inserción datos tabla proveedor
      insert into proveedor(id, descuento_proveedor, nit_proveedor, direccion_proveedor)
	  values
         (01,  '30%', '091456832', 'CR 7 sur: 12-56'),
		 (02,  '20%', '091123932', 'CR 98: 17-110'),
		 (03,  '15%', '091385132', 'CR 65: 27-15'),
		 (04,  '25%', '091382589', 'CR 25: 07-35'),
         (05,  '5%', '0913002579', 'CR 5: 07-15');


      -- inserción datos tabla producto_proveedor
       insert into producto_proveedor(producto_id, proveedor_id, nombre_producto, nombre_proveedor, precio_compra, precio_venta)
	   values
         (01, 01, 'Pan tajado', 'Bimbo', 5000, 7500),
		 (02, 02, 'Atún', 'Van camps', 4000, 5800),
		 (03, 03, 'Arroz', 'Roa', 1800, 2500),
		 (04, 04, 'Cereal', 'Nestlé', 5000, 7500),
         (05, 05, 'Salchichas', 'Zenú', 15000, 17500);


       -- inserción datos tabla cliente_usuario

         insert into cliente_usuario(id, nombre)
	     values
         (01,  'Diana Lozada'),
		 (02,  'Armando Contreras'),
		 (03,  'Dina Lopez'),
		 (04,  'Carlos Gomez'),
         (05,  'Luis Perez');

         -- inserción datos tabla venta

         insert into venta(id, fecha_venta, cantidad, tipo_documento, num_documento, cliente_usuario_id)
	     values
         (01, '2022-10-25', 2,'Cedula', '43789415', 2),
		 (02, '2022-11-15', 2, 'Cedula', '47258963', 3),
		 (03, '2023-09-05', 4, 'Cedula', '68952145', 2),
		 (04, '2022-12-27', 5, 'Cedula', '258456159', 3),
         (05, '2022-10-17', 1, 'Cedula', '258200589', 2);

         -- inserción datos tabla detalle venta

		 insert into detalle_venta(venta_id, producto_proveedor_producto_id,  producto_proveedor_proveedor_id)
	     values
         (01, 02, 02),
		 (02, 04, 04),
		 (03, 01, 01),
		 (04, 03, 03),
         (05, 04, 05);


        -- Consultar productos por medio del nombre, el cual debe mostrar quien o quienes han sido sus proveedores.
        SELECT nombre_proveedor FROM producto_proveedor WHERE nombre_producto = 'Pan Frances';

     -- Consulta SQL donde pueda obtener los productos vendidos digitando tipo de documento y número de documento.

       SELECT nombre_producto from producto_proveedor, venta WHERE tipo_documento = 43789415;   
